# [JavaScript深入之闭包](https://juejin.cn/post/6844903475998900237)
[上级作用域的概念](https://juejin.cn/post/6937469222251560990)
```
var a = 1;

function foo() {
    console.log(a);
}

foo();
```
- a 是什么？ 它是自由变量
    自由变量是指在函数中使用的，但既不是函数参数也不是函数的局部变量的变量。
- 闭包 = 函数 + 函数能够访问的自由变量
    闭包是指那些能够访问自由变量的函数。
- 从技术的角度讲，所有的JavaScript函数都是闭包  这是理论上的闭包，
    1. 函数嵌套函数
    2. 返回， 可以外部调用

    - 从理论角度：所有的函数。因为它们都在创建的时候就将上层上下文的数据保存起来了。哪怕是简单的全局变量也是如此，因为函数中访问全局变量就相当于是在访问自由变量，这个时候使用最外层的作用域。
    - 从实践角度：以下函数才算是闭包：
        1. 即使创建它的上下文已经销毁，它仍然存在（比如，内部函数从父函数中返回）
        2. 在代码中引用了自由变量
    
- 上级作用域的概念
    2.js 3.js 
- JS 堆栈内存释放
    堆内存：存储引用类型值，对象类型就是键值对，函数就是代码字符串。
    堆内存释放：将引用类型的空间地址变量赋值成 null，或没有变量占用堆内存了浏览器就会释放掉这个地址
    栈内存：提供代码执行的环境和存储基本类型值。
    栈内存释放：一般当函数执行完后函数的私有作用域就会被释放掉。

    但栈内存的释放也有特殊情况：① 函数执行完，但是函数的私有作用域内有内容被栈外的变量还在使用的，栈内存就不能释放里面的基本值也就不会被释放。② 全局下的栈内存只有页面被关闭的时候才会被释放

    内部的函数存在外部作用域的引用就会导致闭包。

    闭包中的变量存储的位置是堆内存。

    假如闭包中的变量存储在栈内存中，那么栈的回收 会把处于栈顶的变量自动回收。所以闭包中的变量如果处于栈中那么变量被销毁后，闭包中的变量就没有了。所以闭包引用的变量是出于堆内存中的。
