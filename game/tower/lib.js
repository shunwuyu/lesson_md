!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);var i={};s.r(i),s.d(i,"getCurrentTime",function(){return n}),s.d(i,"random",function(){return r}),s.d(i,"randomPositiveNegative",function(){return a}),s.d(i,"isFunction",function(){return h}),s.d(i,"isTouchDevice",function(){return o}),s.d(i,"requestAnimationFrameTool",function(){return u}),s.d(i,"arraySwap",function(){return c});const n=()=>performance.now(),r=(t,e)=>Math.random()*(e-t)+t,a=()=>Math.random()<.5?-1:1,h=t=>"function"==typeof t,o=()=>"ontouchstart"in window||window.navigator.msMaxTouchPoints,u=(()=>{let t=1e3/60;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>{window.setTimeout(()=>{const s=n();e(s);const i=n();t=1e3/60-(i-s)},t)})})(),c=(t,e,s)=>{const i=t[s];t[s]=t[e],t[e]=i};var d={linear:function(t,e,s,i){return s*t/i+e},easeIn:function(t,e,s,i){return s*(t/=i)*t+e},easeOut:function(t,e,s,i){return-s*(t/=i)*(t-2)+e},easeInOut:function(t,e,s,i){return(t/=i/2)<1?s/2*t*t+e:-s/2*(--t*(t-2)-1)+e}};const{requestAnimationFrameTool:l,isFunction:m,isTouchDevice:p}=i;class g{constructor(t={}){if(!document.createElement("canvas").getContext)return void window.alert("HTML5 Canvas is not supported in your browser.");const{canvasId:e,debug:s,width:n,height:r,highResolution:a,loadLimit:h,soundOn:o}=t;let u=n||window.innerWidth,c=r||window.innerHeight;this.canvas=document.getElementById(e),a&&(this.canvas.style.width=`${u}px`,this.canvas.style.height=`${c}px`,u*=2,c*=2),this.highResolution=a,this.canvas.width=u,this.canvas.height=c,this.width=this.canvas.width,this.height=this.canvas.height,this.calWidth=.5*this.width,this.calHeight=.5*this.height,this.debug=!!s,this.ctx=this.canvas.getContext("2d"),this.defaultLayer="default",this.layerArr=[this.defaultLayer],this.instancesObj={},this.instancesObj[this.defaultLayer]=[],this.instancesReactionArr=[],this.utils=i,this.customVariable={};const d=this;this.isTouchDevice=p(),this.debugArr=[],this.assetsObj={image:{},audio:{}},this.assetsCount={image:0,audio:0},this.assetsErrorQueue=[],this.assetsErrorCount=0,this.loadLimit=h||3,this.soundOn=!!o,this.fps=0,this.lastTime=0,this.lastPausedAt=0,this.pausedTime=0,this.paused=!1,this.timeMovement={},this.timeMovementStartArr=[],this.timeMovementFinishArr=[],this.keyUpListeners={},this.keyDownListeners={},this.keyPressListeners={},this.startAnimate=(()=>{}),this.paintUnderInstance=(()=>{}),this.paintAboveInstance=(()=>{}),this.endAnimate=(()=>{}),this.touchStartListener=(()=>{}),this.touchEndListener=(()=>{}),this.touchMoveListener=(()=>{}),document.addEventListener("keyup",t=>{d.keyListener(t,"keyup")},!1),document.addEventListener("keydown",t=>{d.keyListener(t,"keydown")},!1),document.addEventListener("keypress",t=>{d.keyListener(t,"keypress")},!1),this.isTouchDevice?(document.addEventListener("touchstart",t=>{d.touchStartListener(t)},!1),document.addEventListener("touchend",t=>{d.touchEndListener(t)},!1),document.addEventListener("touchmove",t=>{d.touchMoveListener(t)},!1)):(document.addEventListener("mousedown",t=>{d.touchStartListener(t)},!1),document.addEventListener("mouseup",t=>{d.touchEndListener(t)},!1),document.addEventListener("mousemove",t=>{d.touchMoveListener(t)},!1))}triggerReaction(t,e){let s=t,i=e;this.highResolution&&(s*=2,i*=2),this.instancesReactionArr.forEach(t=>{t.visible&&s>=t.x&&s<=t.x+t.width&&i>=t.y&&i<=t.y+t.height&&t.trigger(t,this)})}addAudio(t,e,s=0){if(!this.soundOn)return;s||(this.assetsCount.audio+=1);const i=new window.Audio;i.src=e,this.assetsObj.audio[t]=i,i.addEventListener("error",()=>{this.assetsErrorQueue.push({name:t,src:e,retry:s+1,type:"audio"})},!1),i.load()}getAudio(t){return this.assetsObj.audio[t]}playAudio(t,e=!1){if(!this.soundOn)return;const s=this.getAudio(t);if(s){if(s.play(),!e)return;s.addEventListener("ended",()=>{s.currentTime=0,s.play()},!1)}}pauseAudio(t){const e=this.getAudio(t);e&&e.pause()}setVariable(t,e){this.customVariable[t]=e}getVariable(t,e=null){const s=this.customVariable[t];return s||(null!==e?(this.setVariable(t,e),e):null)}addImg(t,e,s=0){s||(this.assetsCount.image+=1);const i=new window.Image;i.src=e,i.onload=(()=>{this.assetsObj.image[t]=i}),i.onerror=(()=>{this.assetsErrorQueue.push({name:t,src:e,retry:s+1,type:"image"})})}getImg(t){return this.assetsObj.image[t]}animate(t){const e=t-this.pausedTime,s=this;this.paused?setTimeout(()=>{this.animate.call(s,e)},100):(this.tick(e),this.clean(),this.startAnimate(this,e),this.paintUnderInstance(this),this.updateInstances(e),this.paintInstances(),this.paintAboveInstance(),this.endAnimate(this,e),this.tickTimeMovement(),this.debug&&this.showFps(),this.debug&&this.drawDebug(),l(t=>{this.animate.call(s,t)}))}showFps(){this.ctx.save(),this.ctx.fillStyle="red",this.ctx.font=`${this.highResolution?32:16}px Arial`,this.ctx.fillText(`FPS: ${this.fps.toFixed()}`,5,this.highResolution?40:20),this.ctx.restore()}debugLineX(t){this.debugArr.push({type:"lineX",y:t})}debugLineY(t){this.debugArr.push({type:"lineY",x:t})}debugDot(t,e){this.debugArr.push({type:"dot",x:t,y:e})}drawDebug(){this.debugArr.forEach(t=>{const{type:e,x:s,y:i}=t;switch(e){case"dot":this.drawDebugDot(s,i);break;case"lineX":this.drawDebugLine(null,i);break;case"lineY":this.drawDebugLine(s,null)}}),this.instancesReactionArr.forEach(t=>{t.visible&&(this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.rect(t.x,t.y,t.width,t.height),this.ctx.stroke())})}drawDebugLine(t,e){let s=[0,e],i=[this.width,e];t&&(s=[t,0],i=[t,this.height]),this.ctx.save(),this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.moveTo(...s),this.ctx.lineTo(...i),this.ctx.stroke(),this.ctx.restore()}drawDebugDot(t,e){this.ctx.save(),this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(t,e,2,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.beginPath(),this.ctx.arc(t,e,1,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.restore()}tick(t){this.updateFps(t),this.lastTime=t}updateFps(t){0===this.lastTime?this.fps=60:this.fps=1e3/(t-this.lastTime)}pixelsPerFrame(t){return t/this.fps}tickTimeMovement(){this.timeMovementStartArr.forEach(t=>{this.timeMovement[t].processing=!0}),this.timeMovementStartArr=[],this.timeMovementFinishArr.forEach(t=>{delete this.timeMovement[t]}),this.timeMovementFinishArr=[]}getTimeMovement(t,e,s,i={}){const{before:n,after:r}=i,a=d[i.easing||"linear"],h=i.name||"default",o=this.timeMovement[t];if(!o)return;o.processing||(this.timeMovementStartArr.push(t),o.store[h]=[],e.forEach(t=>{o.store[h].push({start:parseFloat(t[0]),end:parseFloat(t[1])})}),n&&n());const u=(t=!1)=>{const{duration:e}=o;let i=e;if(!t){const t=this.utils.getCurrentTime(),{startTime:e}=o;i=t-e}const n=o.store[h].map(t=>a(i,t.start,t.end-t.start,e));s.apply(this,n)};this.checkTimeMovement(t)?u():(this.timeMovementFinishArr.push(t),u(!0),r&&r())}checkTimeMovement(t){const e=this.timeMovement[t]||{};return this.utils.getCurrentTime()<=e.endTime}setTimeMovement(t,e){const s=this.utils.getCurrentTime();this.timeMovement[t]={startTime:s,endTime:s+e,duration:e,store:{}}}clean(){this.ctx.clearRect(0,0,this.width,this.height),this.debugArr=[]}addLayer(t){this.layerArr.push(t),this.instancesObj[t]=[]}removeLayer(t){this.layerArr=this.layerArr.filter(e=>e!==t),delete this.instancesObj[t]}swapLayer(t,e){this.utils.arraySwap(this.layerArr,t,e)}addInstance(t,e=this.defaultLayer){this.instancesObj[e].push(t),t.trigger&&this.instancesReactionArr.push(t)}getInstance(t,e=this.defaultLayer){return this.instancesObj[e].filter(e=>e.name===t)[0]}removeInstance(t,e=this.defaultLayer){const s=this.getInstance(t,e);s&&(this.instancesObj[e]=this.instancesObj[e].filter(e=>e.name!==t),s.trigger&&(this.instancesReactionArr=this.instancesReactionArr.filter(e=>e.name!==t)))}updateInstances(t){this.layerArr.forEach(e=>{this.instancesObj[e].forEach(e=>{e.update&&e.update(this,t)})})}paintInstances(){this.layerArr.forEach(t=>{this.instancesObj[t].forEach(t=>{t.paint&&t.paint(this)})})}togglePaused(){const t=this.utils.getCurrentTime();this.paused=!this.paused,this.paused?this.lastPausedAt=t:this.pausedTime+=t-this.lastPausedAt}addKeyUpListener(t,e){this.keyUpListeners[t]=e}addKeyDownListener(t,e){this.keyDownListeners[t]=e}addKeyPressListener(t,e){this.keyPressListeners[t]=e}findKeyListener(t,e){return"keyup"===e?this.keyUpListeners[t]:"keydown"===e?this.keyDownListeners[t]:this.keyPressListeners[t]}keyListener(t,e){let s;switch(t.keyCode){case 13:s="enter";break;case 32:s="space";break;case 37:s="leftArrow";break;case 39:s="rightArrow";break;case 38:s="upArrow";break;case 40:s="downArrow";break;default:s=t.keyCode}const i=this.findKeyListener(s,e);i&&i()}load(t,e){const s=setInterval(()=>{const i=this.assetsCount.image+this.assetsCount.audio,n=Object.keys(this.assetsObj.image).length+Object.keys(this.assetsObj.audio).length;e&&m(e)&&e({success:n,failed:this.assetsErrorCount,total:i}),this.assetsErrorQueue.length>0&&(this.assetsErrorQueue.forEach(t=>{const{retry:e,name:s,src:i,type:n}=t;e>=this.loadLimit?this.assetsErrorCount+=1:"image"===n?this.addImg(s,i,e):this.addAudio(s,i,e)}),this.assetsErrorQueue=[]),n===i&&(t&&m(t)?t():this.init(),clearInterval(s))},200)}init(){const t=this;l(e=>{this.animate.call(t,e)})}}class y{constructor(t={}){const{name:e,painter:s,action:i,trigger:n}=t;this.name=e,this.x=0,this.y=0,this.width=0,this.height=0,this.ax=0,this.ay=0,this.vx=0,this.vy=0,this.visible=!0,this.painter=s||null,this.action=i||null,this.trigger=n||null,this.ready=!1}paint(t){null!==this.painter&&this.visible&&this.painter(this,t)}update(t,e){null!==this.action&&this.action(this,t,e)}updateWidth(t){this.width=t,this.calWidth=t/2}updateHeight(t){this.height=t,this.calHeight=t/2}}s.d(e,"Engine",function(){return g}),s.d(e,"Instance",function(){return y})}]);