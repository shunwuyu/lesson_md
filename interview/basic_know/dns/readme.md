[source](http://www.sunhao.win/articles/netwrok-dns.html)

- 浏览器从输入URL到显示页面发生了什么 首先要说什么?
    DNS
- 为什么域名有点啊？

- 什么是DNS
    DNS 即域名系统，全称是 Domain Name System
    DNS 的作用就是将主机名转换成 IP 地址
    1. 一个由分层的 DNS 服务器实现的分布式数据库
    2. 一个使得主机能够查询分布式数据库的应用层协议
     DNS 的查询过程，说白了，就是去向这些 DNS 服务器询问，你知道这个主机名的 IP 是多少吗，不知道？那你知道去哪台 DNS 服务器上可以查到吗？直到查到我想要的 IP 为止。

- 什么是分布式？
    DNS 服务器拥有因特网上所有主机的映射，每台 DNS 只负责部分映射

- 主机 m.n.com  想要获取主机 a.b.com 的 IP 地址
    1. 首先，主机 m.n.com 向它的本地 DNS 服务器发送一个 DNS 查询报文，
    其中包含期待被转换的主机名 a.b.com
        每个 ISP 一般指网络业务提供商都有一台本地 DNS 服务器
    2. 本地 DNS 服务器将该报文转发到根 DNS 服务器；
    3. 该根 DNS 服务器注意到 com 前缀，
        便向本地 DNS 服务器返回 com 对应的顶级域 DNS 服务器（TLD）的 IP 地址列表。
    4. 本地 DNS 服务器则向其中一台 TLD 服务器发送查询报文；
        该 TLD 服务器注意到 b.com 前缀，便向本地 DNS 服务器返回权威 DNS 服务器的 IP 地址。
        意思就是，我不知道 a.b.com 的 IP，不过这些权威服务器可能知道，你去问他们吧；
    5. 该 TLD 服务器注意到 b.com 前缀，便向本地 DNS 服务器返回权威 DNS 服务器的 IP 地址。
        意思就是，我不知道 a.b.com 的 IP，不过这些权威服务器可能知道，你去问他们吧；
    6. 本地 DNS 服务器又向其中一台权威服务器发送查询报文；
    7. 终于，该权威服务器返回了 a.b.com 的 IP 地址；
    8. 本地 DNS 服务器将 a.b.com 跟 IP 地址的映射返回给主机 m.n.com，m.n.com 就可以用该 IP 向 a.b.com 发送请求啦。

    主机 m.n.com 向本地 DNS 服务器 dns.n.com 发出的查询就是递归查询，这个查询是主机 m.n.com 以自己的名义向本地 DNS 服务器请求想要的 IP 映射，并且本地 DNS 服务器直接返回映射结果给到主机。

    而后继的三个查询是迭代查询，包括本地 DNS 服务器向根 DNS 服务器发送查询请求、本地 DNS 服务器向 TLD 服务器发送查询请求、本地 DNS 服务器向权威 DNS 服务器发送查询请求，所有的请求都是由本地 DNS 服务器发出，所有的响应都是直接返回给本地 DNS 服务器。
    
    ![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bb796a3045e409aabb0f89ad40d3fad~tplv-k3u1fbpfcp-watermark.awebp)

- 每次都这样吗？
    为了让我们更快的拿到想要的 IP，DNS 广泛使用了缓存技术。DNS 缓存的原理非常简单，在一个 DNS 查询的过程中，当某一台 DNS 服务器接收到一个 DNS 应答（例如，包含某主机名到 IP 地址的映射）时，它就能够将映射缓存到本地，下次查询就可以直接用缓存里的内容。当然，缓存并不是永久的，每一条映射记录都有一个对应的生存时间，一旦过了生存时间，这条记录就应该从缓存移出。
    有了缓存，大多数 DNS 查询都绕过了根 DNS 服务器，需要向根 DNS 服务器发起查询的请求很少。