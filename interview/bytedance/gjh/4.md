# 操作系统中进程和线程怎么通信 Process vs. Thread



操作系统夺命题
侧重点一：面试官想要了解面试者对这一知识点的理解程度（因为这是操作系统中不得不提的一个概念）。如果这个概念回答不上来，意味着面试者对操作系统的学习并不深。
侧重点二：面试官可以对你的回答作进一步展开，通过你的回答某个侧重点方向来进一步提问你对你自己回答的理解。（这个高频问题的价值所在）。

把上面的概念全都忘掉。只留一个目的：“把敌人打败”
https://zhuanlan.zhihu.com/p/125716637

物理视角   逻辑视角   时许视角
进程可以包括几个或者上百个线程在运行。
内存（逻辑内存）包括在进程里面，每个进程的内存都是互相独立的，但从一个更高的层次上看，不同的进程也共享着一个巨大的空间，这个空间就是整个计算机。
进程共有文件/网络句柄（handle），这样可以打开同一个文件，抢同一个网络端口。

线程的本质：真正运行的是一个一个的线程
PC 程序计数器  TLS 分配内存

 如何通信（沟通）的内容
 进程可以通过管道(pip 文件)、套接字(一个套接字就是网络上进程通信的一端 不同的进程都可以读取同一个端口)、信号交互(是Unix系统中使用的最古老的进程间通信的方法之一, 预先定义的事件)、共享内存、消息队列等等进行通信；而线程本身就会共享内存，指针指向同一个内容，交互很容易。
 一旦有了通信，人与人之间就会产生矛盾，进程也一样。这些矛盾就会体现在如何同步上。

 进程要分配内存，所以开销很大，进程只需要分配栈，分配一个PC就好，内存开销小。

进程和线程的区别

1. 进程是资源分配的最小单位，线程是程序执行的最小单位，CPU调度的最小单位
  因为现在的操作系统都是多任务的操作系统，多任务操作系统是允许多个进程在一个cpu上运行的。
  对于每一个进程而言，都有自己独立的代码和数据空间，这个称之为进程的上下文，cpu从一个进程切换到另外一个进程所做的动作称为进程的上下文切换。操作系统通过频繁的切换进程来实现cpu资源的有效分配，并看起来像在同时运行一样。

  进程的上下文切换和进程间的通信需要有较多的开销，为了执行更多的任务，提升系统的效率，引入了线程。一个进程可以有一个或者多个线程所组成。  更多任务， 浏览器   DOM  网络



2. 进程有自己独立的地址空间，线程共享进程的地址空间
  是进程中的一部分   web workers 
  受操作系统的影响，每个操作系统能同时运行的进程数目是有限的，每个进程能够开启的线程数目也是有上限的，在同一个cpu核心上，多个线程以抢占或者主动让出时间片的形式轮流执行。
  基于同一段代码可以创建多个线程，这些线程共享进程的数据空间，但每个线程有独立的运行栈和程序计数器。


3.  进程之间的资源是独立的，线程共享本进程的资源

1.如果把操作系统的cpu比作一个工厂，进程就好比工厂里面的车间，线程就好比车间里面的工人。

2.cpu在运行时候，就好比工厂里面的点同时只允许一个车间进行生产，所以一个单个cpu就只能同时执行一个任务。

3.进程就好比工厂的车间，它代表CPU所能处理的单个任务。任一时刻，CPU总是运行一个进程，其他进程处于非运行状态。

4、一个车间里，可以有很多工人。他们协同完成一个任务。

5、线程就好比车间里的工人。一个进程可以包括多个线程。

6、车间的空间是工人们共享的，比如许多房间是每个工人都可以进出的。这象征一个进程的内存空间是共享的，每个线程都可以使用这些共享内存。  
7、可是，每间房间的大小不同，有些房间最多只能容纳一个人，比如厕所。里面有人的时候，其他人就不能进去了。这代表一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存。
8、一个防止他人进入的简单方法，就是门口加一把锁。先到的人锁上门，后到的人看到上锁，就在门口排队，等锁打开再进去。这就叫"互斥锁"（Mutual exclusion，缩写 Mutex），防止多个线程同时读写某一块内存区域。
9. 还有些房间，可以同时容纳n个人，比如厨房。也就是说，如果人数大于n，多出来的人只能在外面等着。就好比某些内存区域，只能供给固定数目的线程使用。
10、这时的解决方法，就是在门口挂n把钥匙。进去的人就取一把钥匙，出来时再把钥匙挂回原处。后到的人发现钥匙架空了，就知道必须在门口排队等着了。这种做法叫做"信号量"（Semaphore），用来保证多个线程不会互相冲突。



线程之间的通信更方便，同一进程下的线程共享全局变量、静态变量等数据，而进程之间的通信需要以通信的方式（Inter Process Communication，IPC)进行。不过如何处理好同步与互斥是编写多线程程序的难点。

线程的调度与切换比进程快很多，同时创建一个线程的开销也比进程要小很多。

但是多进程程序更健壮，多线程程序只要有一个线程死掉，整个进程也死掉了，而一个进程死掉并不会对另外一个进程造成影响，因为进程有自己独立的地址空间。