[source](https://juejin.cn/post/6850037270754361352)

- 什么是CDN
  [source](https://juejin.cn/post/6844903906296725518)
  Content Delivery Network 内容分发网络

  虎牙 王者荣耀主播张大仙 到底能不能扛得住 2000万+
  阿里和虎牙联合搞的主播行业边缘CDN还挺6

  2018年1月，阿里云为虎牙提供了边缘节点服务（ENS）。基于阿里云ENS，可以轻松地将业务模块放到边缘运行，在主播的推流时，实现就近节点进行转码和分发，同时支持了高并发实时弹幕的边缘分发。在获得网络低时延的同时，减少了对中心的压力，节省了30%以上的中心带宽成本，并且实现了边缘节点网络连接小于5毫秒延时，提升了主播上行质量，以及用户成功连接占比等数指标，有效提升了用户观看体验。ENS中最主要的技术就是CDN。

  天猫超市  货品先入天猫超市的菜鸟仓，然后由猫超统一派送的
  为了缩短物流的时间，可以让消费者快速的收到货品，菜鸟在全国各地建了本地仓库，猫超下单，第二天都可以收到

  杭州市西湖区发货地址是杭州的萧山仓，从杭州的一个区运输到另外一个区，24小时怎么也到了

  商品销售前就已经来到距离消费者最近的仓储基地，下单购买后，由最近的仓发货，就近配送，速度比跨越多个省市跑过来的快多了

- 打个什么比喻更贴切?  物流
  商品销售前就已经来到距离消费者最近的仓储基地
  全国20哥省份，70个城市，共有327各仓库。这些仓库组合在一起被称之为"全国仓网"。

  网站也可以预先把内容分发至全国各地的加速节点。有效提升下载速度、降低响应时间，提供流畅的用户体验。
  ![](https://user-gold-cdn.xitu.io/2019/8/5/16c5f7c722ca14fc?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

  - CDN技术消除了不同运营商之间互联的瓶颈造成的影响，实现了跨运营商的网络加速，保证不同网络中的用户都能得到良好的访问质量 
  - 广泛分布的CDN节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵以及降低各种DDoS攻击对网站的影响，同时保证较好的服务质量

- 怎么发挥作用呢？
  传统快递企业  商家→网点→分拨→分拨→网点→客户 环节多、时效慢、易破损
  - 用户在自己的浏览器中输入要访问的网站域名。
  - 浏览器向本地DNS服务器请求对该域名的解析。
  - 本地DNS服务器中如果缓存有这个域名的解析结果，则直接响应用户的解析请求。
  - 本地DNS服务器中如果没有关于这个域名的解析结果的缓存，则以迭代方式向整个DNS系统请求解析，获得应答后将结果反馈给浏览器。
  - 浏览器得到域名解析结果，就是该域名相应的服务设备的IP地址 。
  - 浏览器获取IP地址之后，经过标准的TCP握手流程，建立TCP连接。
  - 浏览器向服务器发起HTTP请求。
  - 服务器将用户请求内容传送给浏览器。
  - 经过标准的TCP挥手流程，断开TCP连接。

  CDN 后 比以前快了
  - 当用户点击网站页面上的内容URL，先经过本地DNS系统解析，如果本地DNS服务器没有相应域名的缓存，则本地DNS系统会将域名的解析权交给CNAME指向的CDN专用DNS服务器。
    DD公司老板 你公司中的一台IP为1.1.1.1的服务器 注册了域名为http://www.dd.com 
    访问量也越来越多，服务器顶不住了 找CDN提供商购买CDN加速服务， 
    要求你的域名做个CNAME指向他们给你的一个域名叫http://www.xdd.com
    当用户访问http://www.dd.com的时候，本地DNS会获得CDN提供的CNAME域名：http://www.xdd.com，然后再次向DNS调度系统发出请求，通过DNS调度系统的智能分析，把这个http://www.xdd.com指向一个（离用户地理位置最近的）CDN提供商的服务器IP，让用户就近取到想要的资源（如访问网站），大大降低了延迟。
  - CDN的DNS服务器将CDN的全局负载均衡设备IP地址返回给用户。
  - 用户向CDN的全局负载均衡设备发起URL访问请求。
  - CDN全局负载均衡设备根据用户IP地址，以及用户请求的URL，选择一台用户所属区域的区域负载均衡设备，并将请求转发到此设备上。
  - 基于以下这些条件的综合分析之后，区域负载均衡设备会选择一个最优的缓存服务器节点，并从缓存服务器节点处得到缓存服务器的IP地址，最终将得到的IP地址返回给全局负载均衡设备：
  - 根据用户IP地址，判断哪一个边缘节点距用户最近；
  - 根据用户所请求的URL中携带的内容名称，判断哪一个边缘节点上有用户所需内容；
  - 查询各个边缘节点当前的负载情况，判断哪一个边缘节点尚有服务能力。
  - 全局负载均衡设备把服务器的IP地址返回给用户。
  - 用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。
    








# 如何避免 CDN 为 PC 端缓存移动端页面
这个问题出现在 PC 端和移动端是两套代码，却共用一个域名。